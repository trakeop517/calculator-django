{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>–ö—Ä–µ–¥–∏—Ç–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'core/style.css' %}">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
        <div class="container">
            <a class="navbar-brand" href="/">–ö—Ä–µ–¥–∏—Ç–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    {% if user.is_authenticated %}
                        <li class="nav-item">
                            <span class="nav-link disabled">–ü—Ä–∏–≤–µ—Ç, {{ user.username }}!</span>
                        </li>
                        <li class="nav-item">
                            <form action="{% url 'logout' %}" method="post" class="d-inline">
                                {% csrf_token %}
                                <button type="submit" class="nav-link btn btn-link" style="padding: 0.5rem 1rem;">
                                    –í—ã–π—Ç–∏
                                </button>
                            </form>
                        </li>
                    {% else %}
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'login' %}">–í–æ–π—Ç–∏</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'register' %}">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="text-center my-4">
            <h1 class="display-5 fw-bold">–°—Ä–∞–≤–Ω–∏–≤–∞–π—Ç–µ –∫—Ä–µ–¥–∏—Ç–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–π—Ç–µ –ø–ª–∞—Ç–µ–∂–∏ –æ–Ω–ª–∞–π–Ω</h1>
            <p class="lead">–ù–∞–π–¥–∏—Ç–µ –≤—ã–≥–æ–¥–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ, —Ä–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ –µ–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂ –∏ —á–∏—Ç–∞–π—Ç–µ –ø–æ–ª–µ–∑–Ω—ã–µ —Å—Ç–∞—Ç—å–∏</p>
        </div>

        <div class="row g-4">
            <div class="col-md-4">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-danger text-white">
                        <h5 class="card-title mb-0">üî• –¢–æ–ø-5 –≤—ã–≥–æ–¥–Ω—ã—Ö –∫—Ä–µ–¥–∏—Ç–æ–≤</h5>
                    </div>
                    <div class="card-body">
                        <ul class="list-group list-group-flush">
                            {% for offer in top_offers|slice:":5" %}
                                <li class="list-group-item">
                                    <strong>{{ offer.bank.name }}</strong><br>
                                    {{ offer.credit_type.name }} | {{ offer.rate }}%<br>
                                    <small>–°—Ä–æ–∫: {{ offer.term_min }}‚Äì{{ offer.term_max }} –º–µ—Å.</small>
                                </li>
                            {% empty %}
                                <li class="list-group-item text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</li>
                            {% endfor %}
                        </ul>
                        <a href="{% url 'all_offers' %}" class="btn btn-outline-danger mt-3 w-100">
                            –í—Å–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è ‚Üí
                        </a>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-success text-white">
                        <h5 class="card-title mb-0">üßÆ –ö—Ä–µ–¥–∏—Ç–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</h5>
                    </div>
                    <div class="card-body">
                        <form method="post" class="mb-3">
                            {% csrf_token %}
                            <div class="mb-2">
                                <label class="form-label">–°—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–∞ (‚ÇΩ):</label>
                                <input type="number" name="amount" class="form-control" required>
                            </div>
                            <div class="mb-2">
                                <label class="form-label">–°—Ä–æ–∫ (–º–µ—Å.):</label>
                                <input type="number" name="term" class="form-control" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">–ü—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞ (%):</label>
                                <input type="number" step="0.01" name="rate" class="form-control" required>
                            </div>
                            <button type="submit" class="btn btn-success w-100">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
                        </form>
                        
                        {% if result %}
                            <div class="alert alert-info mt-3">
                                <strong>–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂:</strong> {{ result.monthly_payment }} ‚ÇΩ
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-info text-white">
                        <h5 class="card-title mb-0">üì∞ –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å—Ç–∞—Ç—å–∏</h5>
                    </div>
                    <div class="card-body">
                        <ul class="list-unstyled">
                            {% for article in latest_articles|slice:":5" %}
                                <li class="mb-3">
                                    <img src="{{ article.image_url }}" 
                                         alt="{{ article.title }}" 
                                         width="80" 
                                         class="float-start me-3 rounded">
                                    <a href="{% url 'article_detail' article.id %}" class="text-decoration-none">
                                        {{ article.title|truncatechars:40 }}
                                    </a>
                                    <p class="text-muted small mb-0">{{ article.published_at|date:"d.m.Y" }}</p>
                                </li>
                            {% empty %}
                                <li class="text-muted">–°—Ç–∞—Ç–µ–π –ø–æ–∫–∞ –Ω–µ—Ç</li>
                            {% endfor %}
                        </ul>
                        <a href="{% url 'articles' %}" class="btn btn-outline-info mt-3 w-100">
                            –í—Å–µ —Å—Ç–∞—Ç—å–∏ ‚Üí
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <div class="mt-5">
        <h4 class="mb-3">üí¨ –û—Ç–∑—ã–≤—ã –∫–ª–∏–µ–Ω—Ç–æ–≤</h4>
        <div class="row">
            {% for review in latest_reviews %}
            <div class="col-md-4">
                <blockquote class="blockquote border rounded p-3 h-100 shadow-sm">
                <p>{{ review.text|truncatewords:30 }}</p>
                <footer class="blockquote-footer">{{ review.user.name }} <cite title="Source Title">{{ review.created_at|date:"d.m.Y" }}</cite></footer>
                </blockquote>
            </div>
            {% empty %}
            <p class="text-muted">–û—Ç–∑—ã–≤–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p>
            {% endfor %}
        </div>
        </div>
       <div class="mt-4">
            <h5>üìù –û—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ–π –æ—Ç–∑—ã–≤</h5>

            {% if user.is_authenticated %}
                <form method="post" class="card p-3 shadow-sm">
                    {% csrf_token %}
                    {{ review_form.as_p }}
                    <button type="submit" class="btn btn-outline-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                </form>
            {% else %}
                <div class="alert alert-info">
                    <p>–ß—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤, <a href="{% url 'login' %}?next={{ request.path }}">–≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç</a>.</p>
                </div>
            {% endif %}
        </div>

        <div class="row mt-5">
            <div class="col-md-10 offset-md-1">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title">üîç –ü–æ–∏—Å–∫ –∫—Ä–µ–¥–∏—Ç–æ–≤ –∏ –±–∞–Ω–∫–æ–≤</h5>
                        <form action="{% url 'search_offers' %}" method="get" class="d-flex gap-2">
                            <input type="text" name="q" placeholder="–í–≤–µ–¥–∏—Ç–µ –±–∞–Ω–∫ –∏–ª–∏ —Ç–∏–ø –∫—Ä–µ–¥–∏—Ç–∞" class="form-control">
                            <button type="submit" class="btn btn-primary">–ù–∞–π—Ç–∏</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        </div>
        <div class="row justify-content-center mt-5">
            <div class="col-md-8 col-lg-6">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0 text-center">üìä –í–∞—à–µ –º–Ω–µ–Ω–∏–µ</h4>
                    </div>
                    
                    <div class="card-body">
                        {% if poll %}
                            <form method="post">
                                {% csrf_token %}
                                <h5 class="text-center mb-4">{{ poll.question }}</h5>
                                
                                <div class="list-group mb-4">
                                    {% for option in poll.options.all %}
                                        <label class="list-group-item d-flex align-items-center">
                                            <input type="radio" 
                                                name="choice" 
                                                value="{{ option.id }}"
                                                class="form-check-input me-3" 
                                                required>
                                            <div class="w-100">
                                                <div class="d-flex justify-content-between">
                                                    <span>{{ option.text }}</span>
                                                    <span class="badge bg-primary rounded-pill">{{ option.votes }}</span>
                                                </div>
                                                <div class="progress mt-2" style="height: 5px;">
                                                    <div class="progress-bar" 
                                                        role="progressbar" 
                                                        style="width: {% widthratio option.votes poll.total_votes 100 %}%">
                                                    </div>
                                                </div>
                                            </div>
                                        </label>
                                    {% endfor %}
                                </div>
                                
                                <div class="d-grid">
                                    <button type="submit" class="btn btn-primary btn-lg">
                                        <i class="bi bi-check-circle me-2"></i>–ü—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞—Ç—å
                                    </button>
                                </div>
                            </form>
                        {% else %}
                            <div class="alert alert-info text-center mb-0">
                                –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–ø—Ä–æ—Å–æ–≤
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>